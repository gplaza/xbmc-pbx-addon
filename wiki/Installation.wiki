#summary These are the installation instructions.
#labels Phase-Deploy

= Introduction =

This addon has two components:
  * A front-end, which runs on XBMC side as a _Program Add-on_;
  * A back-end, which runs on the PBX server side as part of the Asterisk itself and as PHP component;

= Download necessary files =

  # Download latest version from here: [http://code.google.com/p/xbmc-pbx-addon/downloads/list]
    * Save this file somewhere, you will need it later;
    * We assume this file is named `script.xbmc-pbx-addon.zip`;

= PBX: Back-end Installation =

== Move files around ==
  # Unzip the `script.xbmc-pbx-addon.zip` file you downloaded before;
  # Find a directory named `backend_files` inside the file you just extracted;
  # Using your favorite FTP program move this folder content to your PBX server;

== PBX Time ==
  # Log-in into your PBX server;
  # Put the `xbmc-pbx-addon.php` file somewhere you can access it from a web browser;
    * i.e. `http://asterisk/xbmc-pbx-addon.php`;
    * You must already have a Web Server (i.e. Apache) running on the server;
  # Using a standard install of !FreePBX and Asterisk you may not have to change any values in the PHP file;
    * Otherwise, do so;
  # Put the `manager_custom.conf` file into `/etc/asterisk/`;
  # If you are not using a standard install of !FreePBX and Asterisk make sure `/etc/asterisk/manager.conf` has an include line like this one:
{{{
#include manager_custom.conf
}}}
  # Append the contents from `extensions_custom.conf.sample` to your own `/etc/asterisk/extensions_custom.conf`;
    * *DO NOT OVERWRITE IT*
  # Once you've finished, restart your PBX software:
    * If you have !FreePBX installed:
{{{
root-pbx$amportal restart
}}}
    * Otherwise:
{{{
root-pbx$/etc/init.d/asterisk restart
}}}

=== Optional ===
  # To stop !Fail2Ban from banning XBMC while setting it up set: 
{{{
ignoreip = [IP OF XBMC]
}}}
    * Do this in `/etc/fail2ban/jail.conf`;
  # Also, restart it:
{{{
root-pbx$service fail2ban restart
}}}

= XBMC: Front-end Installation =

== Via zip file ==
  # In XBMC, go to _System_ -> _Add-ons_ -> _Install from zip file_;
    * Find and select the `script.xbmc-pbx-addon.zip` file you downloaded before;
  # You must see a notification pop-up saying *XBMC PBX Addon* is *Enabled*;

== Autoexec.py (for XBMC Dharma) ==
  # Copy the `autoexec.py` file (from the `script.xbmc-pbx-addon.zip` file you downloaded before) to `~/.xbmc/userdata/`;

== Autoexec.py (for XBMC4XBOX 3.0.1) ==
  # Customize then copy the `autoexec.py` file (from the `script.xbmc-pbx-addon.zip` file you downloaded before) to `Q:\scripts`;

= XBMC: Front-end Configuration =
  # In XBMC, go to _System_ -> _Add-ons_ -> _Enabled Add-ons_ -> _Program Add-ons_ -> _XBMC PBX Addon_ -> _Configure_;
  # _Connection_:
    * Be very careful to put here the correct values for AMI (the ones you put in `/etc/asterisk/manager_custom.conf`);
    * Also set the *hostname* to the correct hostname or IP address for your PBX Server;
  # _CDR & VoiceMail_:
    * Specify the URL you used your web-browser to access the `xbmc-pbx-addon.php`;
, as well as the correct web address;
    * Then you may want to change the *Mailbox Number* for the one you would like to retrieve !VoiceMail messages;
  # _Outbound Calls_:
    * Customize it with the *extension* (and *context*) you would like to use when initiating outbound calls;
  # _Inbound Calls_:
    * The first setting (*...!NewChannel State*) defines how inbound calls are detected so you might try these values:
      * *Ring* if you have an _Asterisk 1.6_ PBX server;
      * *Down* if you have an _Asterisk 1.4_ PBX server; 
    * Personalize the remaining settings to modify the XBMC and Asterisk behavior for inbound calls;

= XBCM Reboot =
  # Reboot XBMC for the background service to automatically start;
  # Once XBMC has loaded, you should see a notification pop-up showing the number of !VoiceMail messages you have in your Mailbox;
    * If not, see the [Troubleshooting] page;

= XBMC: Front-end first run =
  # To open (run) it, just go to _Programs_ from the XBMC home screen and find *XBMC PBX Addon*;
  # In case you didn't if before, you will be prompted to configure this add-on;
  # If everything went fine, you will see the front-end main screen with the list of your phone calls; 
   * Otherwise see the [Troubleshooting] page;